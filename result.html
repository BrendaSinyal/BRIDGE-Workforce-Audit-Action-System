<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Full Report</title>
</head>
<body style="margin:0">
<div id="err" style="font-family:Arial;padding:16px;color:#b00020"></div>
<div id="mount"></div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzsFnAz8I3a0IdnxAmrCk-gdyvYcUbOHO_tcQJx0xNPz_ZrO3OZ_VGM8h6DKYpiwrRu/exec";

const token = new URLSearchParams(location.search).get("t");

function load() {
  if (!token) {
    document.getElementById("err").textContent = "Missing token.";
    return;
  }

  const cb = "cb_" + Date.now();
  window[cb] = function(res) {
    try { delete window[cb]; } catch(e) {}
    if (!res || !res.ok) {
      document.getElementById("err").textContent = (res && res.error) ? res.error : "Not found.";
      return;
    }
    document.getElementById("mount").innerHTML = res.reportHtml;
  };

  const s = document.createElement("script");
  s.src = WEBAPP_URL + "?mode=reportByToken&t=" + encodeURIComponent(token) + "&callback=" + cb;
  s.onerror = () => document.getElementById("err").textContent = "Network error. Refresh.";
  document.body.appendChild(s);
}
load();
</script>
</body>
</html>
