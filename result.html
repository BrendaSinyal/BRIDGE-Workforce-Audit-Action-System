<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B/RIDGE Results</title>
  <style>
    body { font-family: Arial, sans-serif; background:#fff; color:#123; }
    .wrap { max-width: 980px; margin: 28px auto; padding: 0 18px; }
    .card { border: 1px solid #e7eef6; border-radius: 14px; padding: 18px 18px 22px; }
    h1 { font-size: 28px; margin: 0 0 10px; color:#0a4aa6; }
    .topline { height: 2px; background:#c8dcf6; margin: 6px 0 18px; }

    .row { display:flex; gap:26px; flex-wrap:wrap; align-items:flex-start; }
    .left { flex: 1 1 420px; }

    /* --- HALF GAUGE (thick) --- */
    .gaugeRow { display:flex; gap:22px; align-items:flex-start; flex-wrap:wrap; }

    .halfGaugeBox{
      width: 360px;
      max-width: 100%;
    }
    .halfGauge {
      /* container for half circle */
      width: 320px;
      height: 170px; /* half height */
      position: relative;
      overflow: hidden; /* hide bottom half */
    }

    .halfGauge .ring {
      position: absolute;
      left: 0; top: 0;
      width: 320px; height: 320px;
      border-radius: 50%;
      /* thick multi-colour ring across TOP HALF only (180deg) */
      background: conic-gradient(
        /* start at left (180deg) to right (0deg) via top */
        #d64541 180deg 252deg,  /* Critical 0â€“39 (approx 39% of 180 = 70deg) */
        #f39c12 252deg 288deg,  /* Low 40â€“59 */
        #f1c232 288deg 324deg,  /* Moderate 60â€“79 */
        #1fb36a 324deg 360deg   /* High 80â€“100 */
      );
    }

    .halfGauge .cutout{
      position:absolute;
      left: 24px; top: 24px;
      width: 272px; height: 272px;
      border-radius: 50%;
      background:#fff;
      box-shadow: inset 0 0 0 1px #eef3fb;
    }

    /* Needle */
    .needle {
      position:absolute;
      left:50%;
      top: 150px; /* pivot near bottom center of visible half */
      width: 6px;
      height: 120px;
      background:#333;
      border-radius: 6px;
      transform-origin: bottom center;
      transform: translateX(-50%) rotate(0deg);
      box-shadow: 0 2px 6px rgba(0,0,0,.18);
      z-index: 4;
    }
    .hub {
      position:absolute;
      left:50%;
      top: 150px;
      width: 18px; height: 18px;
      border-radius: 50%;
      background:#333;
      transform: translate(-50%,-50%);
      z-index: 5;
    }

    /* Center text */
    .centerText {
      position:absolute;
      left: 0; top: 0;
      width: 320px; height: 170px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index: 3;
      pointer-events:none;
    }
    .pct { font-size: 58px; font-weight: 800; color:#0a2a5a; line-height:1; margin-top: 18px; }
    .pill {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 16px;
      display:inline-block;
    }
    .pill.high { background:#e8f7ef; color:#1a7a4a; }
    .pill.moderate { background:#fff4d8; color:#9a6a00; }
    .pill.low { background:#ffe9d6; color:#a85a00; }
    .pill.critical { background:#ffe1e1; color:#a10f0f; }

    /* legend */
    .legend { margin-top: 8px; font-size: 14px; }
    .legItem { display:flex; align-items:center; gap:10px; margin: 8px 0; }
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot.high { background:#1fb36a; }
    .dot.mod { background:#f1c232; }
    .dot.low { background:#f39c12; }
    .dot.crit { background:#d64541; }
    .legText b { font-weight: 800; }

    /* Section bars */
    h3 { margin: 18px 0 10px; color:#0a2a5a; }
    .section { display:flex; align-items:center; gap:16px; padding: 12px 0; border-top: 1px solid #edf2fb; }
    .section:first-of-type { border-top: 0; }
    .secName { width: 360px; font-weight: 700; color:#0a2a5a; font-size: 14px; }
    .barWrap { flex: 1; height: 18px; background:#f0f5ff; border-radius: 999px; overflow:hidden; }
    .bar { height: 100%; width: 0%; border-radius: 999px; }
    .secVal { width: 60px; text-align:right; font-weight: 800; color:#0a2a5a; }

    /* bar colours (dynamic class) */
    .c-high { background:#1fb36a; }
    .c-mod  { background:#f1c232; }
    .c-low  { background:#f39c12; }
    .c-crit { background:#d64541; }

    .overall { margin-top: 18px; text-align:center; font-weight: 800; color:#0a2a5a; }
    .overall span.big { font-size: 44px; }
    .err { color:#b00020; margin: 8px 0 0; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>B/RIDGEâ„¢ Workforce Readiness Assessment</h1>
      <div class="topline"></div>

      <div class="gaugeRow">
        <!-- Half gauge -->
        <div class="halfGaugeBox">
          <div class="halfGauge">
            <div class="ring"></div>
            <div class="cutout"></div>

            <div class="centerText">
              <div class="pct" id="pct">â€”%</div>
              <div class="pill moderate" id="readinessPill">â€”</div>
            </div>

            <div class="needle" id="needle"></div>
            <div class="hub"></div>
          </div>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legItem"><div class="dot high"></div><div class="legText"><b>High</b> Readiness 80â€“100%</div></div>
          <div class="legItem"><div class="dot mod"></div><div class="legText"><b>Moderate</b> Readiness 60â€“79%</div></div>
          <div class="legItem"><div class="dot low"></div><div class="legText"><b>Low</b> Readiness 40â€“59%</div></div>
          <div class="legItem"><div class="dot crit"></div><div class="legText"><b>Critical</b> Readiness 0â€“39%</div></div>
        </div>
      </div>

      <h3>Section Scores:</h3>

      <div class="section">
        <div class="secName">Build â€“ Foundations &amp; Structures</div>
        <div class="barWrap"><div class="bar c-mod" id="barBuild"></div></div>
        <div class="secVal" id="valBuild">â€”%</div>
      </div>
      <div class="section">
        <div class="secName">Recognise â€“ Acknowledge &amp; Value</div>
        <div class="barWrap"><div class="bar c-mod" id="barRec"></div></div>
        <div class="secVal" id="valRec">â€”%</div>
      </div>
      <div class="section">
        <div class="secName">Inspire â€“ Motivation &amp; Engagement</div>
        <div class="barWrap"><div class="bar c-mod" id="barIns"></div></div>
        <div class="secVal" id="valIns">â€”%</div>
      </div>
      <div class="section">
        <div class="secName">Develop â€“ Skills &amp; Growth</div>
        <div class="barWrap"><div class="bar c-mod" id="barDev"></div></div>
        <div class="secVal" id="valDev">â€”%</div>
      </div>
      <div class="section">
        <div class="secName">Guide â€“ Direction &amp; Support</div>
        <div class="barWrap"><div class="bar c-mod" id="barGui"></div></div>
        <div class="secVal" id="valGui">â€”%</div>
      </div>
      <div class="section">
        <div class="secName">Empower â€“ Ownership &amp; Sustainability</div>
        <div class="barWrap"><div class="bar c-mod" id="barEmp"></div></div>
        <div class="secVal" id="valEmp">â€”%</div>
      </div>

      <div class="overall">
        Overall Readiness Score: <span class="big" id="overall">â€”%</span>
        <span style="font-size:18px;" id="overallLabel"></span>
      </div>

      <div class="err" id="err"></div>
    </div>
  </div>

<script>
  // ðŸ”§ paste your Apps Script Web App URL here
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxawEyd4imKhL--Y995FMk8KYZGH1oo7G6ylqr0XRJWrpQlpSN3-aOBjQv-Cy1HCkdk/exec";

  const params = new URLSearchParams(location.search);
  const token = params.get("t");

  function jsonp(url, cbName, onDone) {
    window[cbName] = function(res){
      try { delete window[cbName]; } catch(e){}
      onDone(res);
    };
    const s = document.createElement("script");
    s.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cbName;
    s.onerror = () => onDone({ok:false, error:"Network error"});
    document.body.appendChild(s);
  }

  function roundPct(x){
    const n = Number(x);
    if (isNaN(n)) return null;
    return Math.round(n);
  }

  // score -> class colour
  function colourClass(score){
    const s = Number(score);
    if (isNaN(s)) return "c-mod";
    if (s >= 80) return "c-high";
    if (s >= 60) return "c-mod";
    if (s >= 40) return "c-low";
    return "c-crit";
  }

  function setBar(barId, valId, value){
    const pct = roundPct(value);
    const bar = document.getElementById(barId);

    bar.style.width = (pct===null ? "0%" : pct + "%");

    // set colour based on score
    bar.classList.remove("c-high","c-mod","c-low","c-crit");
    bar.classList.add(colourClass(pct));

    document.getElementById(valId).textContent = (pct===null ? "â€”%" : pct + "%");
  }

  function setReadinessPill(readiness){
    const pill = document.getElementById("readinessPill");
    const r = String(readiness || "").toLowerCase();
    pill.className = "pill " + (r==="high" ? "high" : r==="moderate" ? "moderate" : r==="low" ? "low" : "critical");
    pill.textContent = readiness ? (readiness + " Readiness") : "â€”";
  }

  // HALF GAUGE needle:
  // We use 180deg sweep (left to right).
  // 0% => -90deg? Actually easiest:
  // left end = -90deg, right end = +90deg (total 180deg)
  function setNeedle(score){
    const s = Math.max(0, Math.min(100, Number(score)));
    const angle = -90 + (s/100)*180; // -90 to +90
    document.getElementById("needle").style.transform = "translateX(-50%) rotate(" + angle + "deg)";
  }

  function load(){
    const errEl = document.getElementById("err");
    if (!token) { errEl.textContent = "Missing token."; return; }

    const cb = "cb_" + Date.now();
    const url = WEBAPP_URL + "?mode=byToken&t=" + encodeURIComponent(token);

    jsonp(url, cb, function(res){
      if (!res || !res.ok){
        errEl.textContent = (res && res.error) ? res.error : "Result not found.";
        return;
      }

      const total = roundPct(res.totalScore);

      document.getElementById("pct").textContent = (total===null ? "â€”%" : total + "%");
      document.getElementById("overall").textContent = (total===null ? "â€”%" : total + "%");
      document.getElementById("overallLabel").textContent = res.readiness ? (res.readiness + " Readiness") : "";

      setReadinessPill(res.readiness);
      setNeedle(total || 0);

      const sec = res.section || {};
      setBar("barBuild","valBuild",sec.build);
      setBar("barRec","valRec",sec.recognise);
      setBar("barIns","valIns",sec.inspire);
      setBar("barDev","valDev",sec.develop);
      setBar("barGui","valGui",sec.guide);
      setBar("barEmp","valEmp",sec.empower);
    });
  }

  load();
</script>
</body>
</html>
