<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B/RIDGE Results</title>
  <style>
    body { font-family: Arial, sans-serif; background:#fff; color:#123; }
    .wrap { max-width: 980px; margin: 28px auto; padding: 0 18px; }
    .card { border: 1px solid #e7eef6; border-radius: 14px; padding: 18px 18px 22px; }
    h1 { font-size: 28px; margin: 0 0 10px; color:#0a4aa6; }
    .topline { height: 2px; background:#c8dcf6; margin: 6px 0 18px; }

    .row { display:flex; gap:26px; flex-wrap:wrap; align-items:flex-start; }
    .left { flex: 1 1 420px; }
    .right { flex: 0 0 320px; }

    /* Gauge */
    .gaugeWrap { display:flex; align-items:center; gap:18px; }
    .gauge {
      width: 240px; height: 240px; border-radius: 50%;
      background: conic-gradient(
        #1fb36a 0deg 72deg,     /* High 20% */
        #f1c232 72deg 180deg,   /* Moderate 40% */
        #f39c12 180deg 252deg,  /* Low 20% */
        #d64541 252deg 360deg   /* Critical 20% */
      );
      position: relative;
      box-shadow: 0 4px 18px rgba(0,0,0,0.06);
    }
    .gauge::after{
      content:"";
      position:absolute; inset:20px;
      background:#fff; border-radius:50%;
      box-shadow: inset 0 0 0 1px #eef3fb;
    }
    .gaugeCenter {
      position:absolute; inset:0;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      z-index:2;
    }
    .pct { font-size: 52px; font-weight: 800; color:#0a2a5a; line-height:1; }
    .label { font-weight: 800; font-size: 16px; padding: 6px 12px; border-radius: 999px; margin-top: 10px; }
    .label.high { background:#e8f7ef; color:#1a7a4a; }
    .label.moderate { background:#fff4d8; color:#9a6a00; }
    .label.low { background:#ffe9d6; color:#a85a00; }
    .label.critical { background:#ffe1e1; color:#a10f0f; }

    /* needle */
    .needle {
      position:absolute; left:50%; top:50%;
      width: 6px; height: 96px;
      background:#3b3b3b;
      transform-origin: bottom center;
      transform: translateX(-50%) translateY(-100%) rotate(0deg);
      border-radius: 6px;
      z-index:3;
      box-shadow: 0 2px 6px rgba(0,0,0,.18);
    }
    .hub {
      position:absolute; left:50%; top:50%;
      width: 18px; height: 18px; border-radius: 50%;
      background:#3b3b3b;
      transform: translate(-50%,-50%);
      z-index:4;
    }

    /* legend */
    .legend { margin-top: 6px; font-size: 14px; }
    .legItem { display:flex; align-items:center; gap:10px; margin: 8px 0; }
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot.high { background:#1fb36a; }
    .dot.mod { background:#f1c232; }
    .dot.low { background:#f39c12; }
    .dot.crit { background:#d64541; }
    .legText b { font-weight: 800; }

    /* Section bars */
    h3 { margin: 18px 0 10px; color:#0a2a5a; }
    .section { display:flex; align-items:center; gap:16px; padding: 10px 0; border-top: 1px solid #edf2fb; }
    .section:first-of-type { border-top: 0; }
    .secName { width: 310px; font-weight: 700; color:#0a2a5a; font-size: 14px; }
    .barWrap { flex: 1; height: 16px; background:#f0f5ff; border-radius: 999px; overflow:hidden; }
    .bar { height: 100%; width: 0%; background:#f1c232; border-radius: 999px; }
    .secVal { width: 52px; text-align:right; font-weight: 800; color:#0a2a5a; }

    .overall { margin-top: 16px; text-align:center; font-weight: 800; color:#0a2a5a; }
    .overall span { font-size: 40px; }
    .err { color:#b00020; margin: 8px 0 0; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>B/RIDGEâ„¢ Workforce Readiness Assessment</h1>
      <div class="topline"></div>

      <div class="row">
        <div class="left">
          <div class="gaugeWrap">
            <div class="gauge" id="gauge">
              <div class="needle" id="needle"></div>
              <div class="hub"></div>
              <div class="gaugeCenter">
                <div class="pct" id="pct">â€”%</div>
                <div class="label moderate" id="readinessPill">â€”</div>
              </div>
            </div>

            <div class="legend">
              <div class="legItem"><div class="dot high"></div><div class="legText"><b>High</b> Readiness 80â€“100%</div></div>
              <div class="legItem"><div class="dot mod"></div><div class="legText"><b>Moderate</b> Readiness 60â€“79%</div></div>
              <div class="legItem"><div class="dot low"></div><div class="legText"><b>Low</b> Readiness 40â€“59%</div></div>
              <div class="legItem"><div class="dot crit"></div><div class="legText"><b>Critical</b> Readiness 0â€“39%</div></div>
            </div>
          </div>

          <h3>Section Scores:</h3>

          <div class="section">
            <div class="secName">Build â€“ Foundations &amp; Structures</div>
            <div class="barWrap"><div class="bar" id="barBuild"></div></div>
            <div class="secVal" id="valBuild">â€”%</div>
          </div>
          <div class="section">
            <div class="secName">Recognise â€“ Acknowledge &amp; Value</div>
            <div class="barWrap"><div class="bar" id="barRec"></div></div>
            <div class="secVal" id="valRec">â€”%</div>
          </div>
          <div class="section">
            <div class="secName">Inspire â€“ Motivation &amp; Engagement</div>
            <div class="barWrap"><div class="bar" id="barIns"></div></div>
            <div class="secVal" id="valIns">â€”%</div>
          </div>
          <div class="section">
            <div class="secName">Develop â€“ Skills &amp; Growth</div>
            <div class="barWrap"><div class="bar" id="barDev"></div></div>
            <div class="secVal" id="valDev">â€”%</div>
          </div>
          <div class="section">
            <div class="secName">Guide â€“ Direction &amp; Support</div>
            <div class="barWrap"><div class="bar" id="barGui"></div></div>
            <div class="secVal" id="valGui">â€”%</div>
          </div>
          <div class="section">
            <div class="secName">Empower â€“ Ownership &amp; Sustainability</div>
            <div class="barWrap"><div class="bar" id="barEmp"></div></div>
            <div class="secVal" id="valEmp">â€”%</div>
          </div>

          <div class="overall">
            Overall Readiness Score: <span id="overall">â€”%</span> <span style="font-size:20px;" id="overallLabel"></span>
          </div>

          <div class="err" id="err"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ðŸ”§ paste your Apps Script Web App URL here
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxawEyd4imKhL--Y995FMk8KYZGH1oo7G6ylqr0XRJWrpQlpSN3-aOBjQv-Cy1HCkdk/exec";

  const params = new URLSearchParams(location.search);
  const token = params.get("t");

  function jsonp(url, cbName, onDone) {
    window[cbName] = function(res){
      try { delete window[cbName]; } catch(e){}
      onDone(res);
    };
    const s = document.createElement("script");
    s.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cbName;
    s.onerror = () => onDone({ok:false, error:"Network error"});
    document.body.appendChild(s);
  }

  function roundPct(x){
    const n = Number(x);
    if (isNaN(n)) return null;
    return Math.round(n);
  }

  function setBar(barId, valId, value){
    const pct = roundPct(value);
    document.getElementById(valId).textContent = (pct===null ? "â€”%" : pct + "%");
    document.getElementById(barId).style.width = (pct===null ? "0%" : pct + "%");
  }

  function setReadinessPill(readiness){
    const pill = document.getElementById("readinessPill");
    const r = String(readiness || "").toLowerCase();
    pill.className = "label " + (r==="high" ? "high" : r==="moderate" ? "moderate" : r==="low" ? "low" : "critical");
    pill.textContent = (readiness ? (readiness + " Readiness") : "â€”");
  }

  // Map score 0â€“100 to needle angle:
  // We'll use 0% = 252deg (Critical start), 100% = 72deg (High end) around the circle
  function setNeedle(score){
    const s = Math.max(0, Math.min(100, Number(score)));
    // linear map: 0 -> 252deg, 100 -> 72deg (wrap)
    // We'll map through 360 by going forward: 252 to 432 (same as 72)
    const angle = 252 + (s/100)*180; // 252 -> 432
    document.getElementById("needle").style.transform =
      "translateX(-50%) translateY(-100%) rotate(" + angle + "deg)";
  }

  function load(){
    const errEl = document.getElementById("err");
    if (!token) { errEl.textContent = "Missing token."; return; }

    const cb = "cb_" + Date.now();
    const url = WEBAPP_URL + "?mode=byToken&t=" + encodeURIComponent(token);
    jsonp(url, cb, function(res){
      if (!res || !res.ok){
        errEl.textContent = (res && res.error) ? res.error : "Result not found.";
        return;
      }

      const total = roundPct(res.totalScore);
      document.getElementById("pct").textContent = (total===null ? "â€”%" : total + "%");
      document.getElementById("overall").textContent = (total===null ? "â€”%" : total + "%");
      document.getElementById("overallLabel").textContent = res.readiness ? (res.readiness + " Readiness") : "";

      setReadinessPill(res.readiness);
      setNeedle(total || 0);

      const sec = res.section || {};
      setBar("barBuild","valBuild",sec.build);
      setBar("barRec","valRec",sec.recognise);
      setBar("barIns","valIns",sec.inspire);
      setBar("barDev","valDev",sec.develop);
      setBar("barGui","valGui",sec.guide);
      setBar("barEmp","valEmp",sec.empower);
    });
  }

  load();
</script>
</body>
</html>
